{"version":3,"sources":["hooks/useShallowEqualSelector.ts","containers/Private.tsx","modules/Chat/actions.ts","hooks/useActions.ts","services/api.ts","services/channel.ts","services/socket.ts","components/MainMenu/index.tsx","containers/ModalWindow.tsx","modules/Auth/actions.ts","components/UserProfile/index.tsx","components/UserMenu/index.tsx","components/App/Header/index.tsx","components/App/Sidebar/CreateChannel/index.tsx","components/App/Sidebar/SidebarMenu/index.tsx","components/App/Sidebar/index.tsx","hooks/useEscape.ts","containers/PrivateRoute.tsx","components/Chat/Messages/index.tsx","components/Chat/InputMessage/index.tsx","components/Chat/index.tsx","services/auth.ts","components/Login/index.tsx","components/Register/index.tsx","components/Recover/index.tsx","components/ChangePassword/index.tsx","components/Activation/index.tsx","components/Routes/index.tsx","components/App/index.tsx","modules/Auth/sagas.ts","modules/Auth/reducer.ts","modules/Chat/reducer.ts","modules/launchSaga.ts","modules/index.ts","modules/store.ts","reportWebVitals.ts","index.tsx"],"names":["useShallowEqualSelector","selector","useSelector","shallowEqual","PrivateContainer","children","state","auth","user","setActiveChannel","createAction","addChannel","initChannelsData","initContactsData","sendChannelMessage","sendContactMessage","useActions","actions","deps","dispatch","useDispatch","useMemo","Array","isArray","map","a","bindActionCreators","AUTH_TOKEN_STORAGE_KEY","makeError","error","response","data","status","message","type","apiService","getToken","localStorage","getItem","send","method","endpoint","payload","axios","interceptors","request","use","config","token","headers","Authorization","channelService","createChannel","api","fetchUserChannels","userId","getUserChannels","userChannelsData","userChannelsList","userContactsList","id","name","channels","reduce","acc","ownerId","members","photo","messages","contacts","console","log","WS","socket","undefined","connect","io","autoConnect","subscribeToChannels","emit","subscribeToChannel","channelId","inviteToChannel","disconnect","menuItems","key","label","path","icon","PieChartOutlined","MainMenu","location","useLocation","history","useHistory","find","item","pathname","mode","selectedKeys","onClick","clicked","_item","push","Item","ModalWindow","props","title","visible","onOk","onCancel","afterClose","destroyOnClose","footer","style","centered","userLoginRequest","userLogoutRequest","userFetchSuccess","userFetchFailure","UserProfile","email","role","UserMenu","useState","userProfileModalVisibility","setUserProfileModalVisibility","dispatchUserLogoutRequest","menu","event","ProfileOutlined","Divider","LogoutOutlined","overlay","trigger","className","UserOutlined","Text","Typography","AntHeader","Layout","Header","activeChannel","chat","onSidebarToggle","sidebarCollapsed","onTriggerClick","menuTrigger","MenuUnfoldOutlined","fontSize","padding","MenuFoldOutlined","activeChannelLabel","beforeUpload","file","isJpgOrPng","isLt2M","size","getBase64","src","url","Promise","resolve","reader","FileReader","readAsDataURL","originFileObj","onload","img","Image","target","result","el","elem","document","createElement","scaleFactor","width","height","ctx","getContext","drawImage","srcEncoded","canvas","toDataURL","onPreview","image","window","open","write","outerHTML","CreateChannel","Form","useForm","form","loading","setLoading","setPhoto","dispatchActiveChannel","dispatchAddChannel","onFinish","values","description","serverMessage","success","activeChannelPayload","fileList","setFileList","onChange","newFileList","imageUrl","rotate","shape","modalTitle","modalOk","modalCancel","listType","customRequest","options","onSuccess","length","layout","rules","required","max","placeholder","indicator","LoadingOutlined","spin","delay","resetFields","disabled","htmlType","SidebarMenu","createChannelModalVisibility","setCreateChannelModalVisibility","UsergroupAddOutlined","UserAddOutlined","ContactsOutlined","SettingOutlined","MenuOutlined","Sider","renderTrackVertical","ownProps","backgroundColor","right","bottom","top","borderRadius","renderThumbVertical","boxShadow","Sidebar","onEscape","sidebarLocked","setSidebarLocked","useEffect","handleEsc","addEventListener","removeEventListener","onClickMenu","split","channelType","intChannelId","parseInt","selectedMenuKey","collapsed","collapsedWidth","theme","overflow","LockOutlined","UnlockOutlined","Object","keys","hideTracksWhenNotNeeded","autoHide","autoHideTimeout","entries","channel","MessageFilled","color","PrivateRoute","Component","component","rest","render","routeProps","to","from","defaultProps","Messages","text","InputMessage","memo","sendMessage","autoFocus","SendOutlined","Chat","dispatchSendChannelMessage","dispatchSendContactMessage","onSendMessage","useCallback","nanoid","activeChannelId","channelData","authService","getAllUsers","register","activate","code","login","fetchByToken","recover","checkSecret","changePassword","setToken","setItem","removeToken","removeItem","Login","emptyMessage","alert","setAlert","dispatchUserLoginRequest","password","initialValues","remember","min","prefix","MailOutlined","Password","noStyle","block","Register","validateTrigger","pattern","dependencies","getFieldValue","validator","_","value","reject","Error","Recover","ChangePassword","useParams","secretError","setSecretError","changeSuccess","setChangeSuccess","secretType","match","Activation","activateUser","Routes","exact","Content","App","needRecreateRef","setNeedRecreateRef","setSidebarCollapsed","SR","useRef","isCollapsed","current","on","reason","off","userLoginRequestFlow","userLoginWatcher","userLogoutRequestFlow","userLogoutWatcher","put","call","takeLatest","authSagas","generator","fork","handleActions","_state","action","authReducer","combineReducers","addMessage","chatReducer","launchSaga","rootSaga","rootReducer","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","store","sagaMiddleware","createSagaMiddleware","createStore","compose","composeWithDevTools","applyMiddleware","run","createAppStore","getElementById"],"mappings":"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","file":"static/js/main.3f1dfe16.chunk.js","sourcesContent":["import { useSelector, shallowEqual } from 'react-redux'\nimport { IRootState } from 'modules'\n\nconst useShallowEqualSelector = (selector: any) =>\n  useSelector<IRootState>(selector, shallowEqual)\n\nexport { useShallowEqualSelector }\n","import { useShallowEqualSelector } from 'hooks/useShallowEqualSelector'\n\nconst PrivateContainer = ({ children }) => {\n  const user = useShallowEqualSelector((state) => state.auth.user)\n  if (!user) return null\n\n  return children\n}\n\nexport { PrivateContainer }\n","import { createAction } from 'redux-actions'\r\n\r\n/** Установить активный канал чата (id, label) */\r\nexport const setActiveChannel: any = createAction('CHAT/SET_ACTIVE_CHANNEL')\r\n\r\n/** Добавление нового канала */\r\nexport const addChannel: any = createAction('CHAT/ADD_CHANNEL')\r\n\r\n/** Начальное состояние каналов на момент захода пользователя */\r\nexport const initChannelsData: any = createAction('CHAT/INIT_CHANNELS_DATA')\r\n/** Начальное состояние контактов на момент захода пользователя */\r\nexport const initContactsData: any = createAction('CHAT/INIT_CONTACTS_DATA')\r\n/** Отправить сообщение в чат канала */\r\nexport const sendChannelMessage: any = createAction('CHAT/SEND_CHANNEL_MESSAGE')\r\n/** Отправить приватное сообщение пользователю */\r\nexport const sendContactMessage: any = createAction('CHAT/SEND_CONTACT_MESSAGE')\r\n","import { bindActionCreators } from 'redux'\nimport { useDispatch } from 'react-redux'\nimport { useMemo } from 'react'\n\nconst useActions = (actions, deps) => {\n  const dispatch = useDispatch()\n\n  return useMemo(\n    () => {\n      if (Array.isArray(actions)) {\n        return actions.map((a) => bindActionCreators(a, dispatch))\n      }\n      return bindActionCreators(actions, dispatch)\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    deps ? [dispatch, ...deps] : [dispatch]\n  )\n}\n\nexport { useActions }\n","import axios, { AxiosRequestConfig, AxiosResponse } from 'axios'\n\nexport interface IServerResponse {\n  type: any\n  message?: string\n  data?: any\n  errors?: string[]\n  token?: string\n}\n\n/** Сообщение при недоступном соединении */\nexport const SERVER_UNAVAILABLE =\n  'Сервер не отвечает или временно недоступен. Попробуйте повторить запрос позднее.'\n\n/** Ключ, по которому в localStorage хранится токен */\nexport const AUTH_TOKEN_STORAGE_KEY = 'auth'\n\n/** Отказ в предоставлении ресурса из-за неверного токена */\nexport const AUTH_REJECTION_MESSAGE =\n  'Войдите или зарегистрируйтесь для просмотра данного содержимого.'\n\nexport const makeError = (error: any): IServerResponse => {\n  const {\n    response: { data, status }\n  } = error\n\n  if (typeof data === 'string' && (status === 502 || status === 500)) {\n    return {\n      type: 'error',\n      message: SERVER_UNAVAILABLE\n    }\n  }\n\n  if (data?.message === 'No authorization token was found') {\n    return {\n      type: 'error',\n      message: AUTH_REJECTION_MESSAGE\n    }\n  }\n\n  return data\n}\n\nconst apiService = {\n  getToken: (): string | null => localStorage.getItem(AUTH_TOKEN_STORAGE_KEY),\n\n  send: async ({\n    method,\n    endpoint,\n    payload = {}\n  }): Promise<IServerResponse> => {\n    try {\n      const response: AxiosResponse = await axios[method](endpoint, payload)\n      return response.data\n    } catch (error) {\n      return makeError(error)\n    }\n  }\n}\n\naxios.interceptors.request.use(\n  (config: AxiosRequestConfig) => {\n    const token = apiService.getToken()\n\n    if (token) {\n      // eslint-disable-next-line no-param-reassign\n      config.headers = {\n        Authorization: `Bearer ${token}`\n      }\n    }\n\n    return config\n  },\n  (error) => makeError(error)\n)\n\nexport { apiService }\n","import { apiService as api, IServerResponse } from './api'\n\ninterface ICreateChannelData {\n  name: string\n  description?: string\n  photo?: string\n  ownerId: number\n}\n\nconst channelService = {\n  /** Создать новый канал */\n  createChannel: async (\n    payload: ICreateChannelData\n  ): Promise<IServerResponse> =>\n    api.send({\n      method: 'put',\n      endpoint: '/api/v1/chat/channel',\n      payload\n    }),\n\n  /** Редактировать канал */\n  // updateChannel: async (payload: any): Promise<ServerResponse> =>\n  //   api.send({\n  //     method: 'patch',\n  //     endpoint: '/api/v1/chat/channel',\n  //     payload\n  //   }),\n\n  // /** Удалить канал */\n  // removeChannel: async (payload: any): Promise<ServerResponse> =>\n  //   api.send({\n  //     method: 'delete',\n  //     endpoint: '/api/v1/chat/channel',\n  //     payload\n  //   }),\n\n  /** Получить список каналов пользователя */\n  fetchUserChannels: async (userId: number): Promise<IServerResponse> =>\n    api.send({\n      method: 'get',\n      endpoint: `/api/v1/chat/channels/${userId}`\n    }),\n\n  /** Получить отформатированный список каналов */\n  getUserChannels: async (userId: number): Promise<any> => {\n    try {\n      const userChannelsData = await channelService.fetchUserChannels(userId)\n      const userChannelsList = userChannelsData.data\n\n      const userContactsList =\n        userId === 1\n          ? [\n              {\n                id: 2,\n                name: 'Demo',\n                type: 'contact'\n              }\n            ]\n          : [\n              {\n                id: 1,\n                name: 'Rooks',\n                type: 'contact'\n              }\n            ]\n\n      const channels = userChannelsList.reduce(\n        (acc, { id, ownerId, name, members, photo }) => ({\n          ...acc,\n          [id]: {\n            ownerId,\n            name,\n            members,\n            type: 'channel',\n            photo,\n            messages: []\n          }\n        }),\n        {}\n      )\n\n      const contacts = userContactsList.reduce(\n        (acc, { id, name, type }) => ({\n          ...acc,\n          [id]: {\n            name,\n            type,\n            messages: []\n          }\n        }),\n        {}\n      )\n\n      const data = { channels, contacts }\n      return { userChannelsList, userContactsList, data }\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.log(error)\n    }\n\n    return null\n  }\n}\n\nexport { channelService }\n","import { io } from 'socket.io-client'\nimport { channelService } from 'services/channel'\n\nconst WS = {\n  socket: undefined,\n  connect: async (userId: number) => {\n    if (!WS.socket) {\n      WS.socket = io('/chat', {\n        autoConnect: false\n      })\n\n      WS.socket.auth = { userId }\n      WS.socket.connect()\n    }\n\n    return WS.subscribeToChannels(userId)\n  },\n  subscribeToChannels: async (userId: number) => {\n    const {\n      userChannelsList,\n      userContactsList,\n      data\n    } = await channelService.getUserChannels(userId)\n\n    WS.socket.emit('channels:subscribe', { userChannelsList, userContactsList })\n    return data\n  },\n  subscribeToChannel: async (channelId: number) => {\n    WS.socket.emit('channel:subscribe', channelId)\n  },\n  inviteToChannel: async (userId: number, channelId: number) => {\n    WS.socket.emit('channel:invite', { userId, channelId })\n  },\n  sendChannelMessage: (payload) => {\n    WS.socket.emit('channel:message:send', payload)\n  },\n  sendContactMessage: (payload) => {\n    WS.socket.emit('contact:message:send', payload)\n  },\n  disconnect: () => {\n    WS.socket.disconnect()\n    WS.socket = undefined\n  }\n}\n\nexport { WS }\n","import { FC } from 'react'\nimport { useLocation, useHistory } from 'react-router-dom'\nimport { Menu } from 'antd'\nimport { PieChartOutlined } from '@ant-design/icons'\n\nconst menuItems = [\n  {\n    key: 'login',\n    label: 'Войти',\n    path: '/auth/login',\n    icon: <PieChartOutlined />\n  },\n  {\n    key: 'register',\n    label: 'Регистрация',\n    path: '/auth/register',\n    icon: <PieChartOutlined />\n  }\n]\n\nconst MainMenu: FC = () => {\n  const location = useLocation()\n  const history = useHistory()\n\n  const key = menuItems.find((item) => location.pathname === item.path)?.key\n  if (!key) return null\n\n  const onClickMenu = (item) => {\n    if (item.key === key) return\n    const clicked = menuItems.find((_item) => _item.key === item.key)\n    history.push(clicked.path)\n  }\n\n  return (\n    <Menu mode=\"horizontal\" selectedKeys={[key]} onClick={onClickMenu}>\n      {menuItems.map((item) => (\n        <Menu.Item key={item.key} icon={item.icon}>\n          {item.label}\n        </Menu.Item>\n      ))}\n    </Menu>\n  )\n}\n\nexport { MainMenu }\n","import { FC, Component, ReactElement } from 'react'\nimport { Modal } from 'antd'\n\ninterface IModalWindowProps {\n  title?: string\n  visible?: boolean\n  centered?: boolean\n  onOk?: () => any | null\n  onCancel?: () => any | null\n  afterClose?: () => any | null\n  destroyOnClose?: boolean\n  footer?: Component[] | FC[] | ReactElement[] | null\n  style?: object | null\n}\n\nconst ModalWindow: FC<IModalWindowProps> = (props) => {\n  const {\n    children,\n    title = '',\n    visible = false,\n    onOk = null,\n    onCancel = null,\n    afterClose = null,\n    destroyOnClose = true,\n    footer = null,\n    style = null\n  } = props\n\n  return (\n    <Modal\n      centered\n      title={title}\n      visible={visible}\n      onOk={onOk}\n      onCancel={onCancel}\n      afterClose={afterClose}\n      destroyOnClose={destroyOnClose}\n      footer={footer}\n      style={style}\n    >\n      {children}\n    </Modal>\n  )\n}\n\nexport { ModalWindow }\n","import { createAction } from 'redux-actions'\r\n\r\n/** Записать токен пользователя в стор */\r\nexport const userLoginRequest: any = createAction('AUTH/USER_LOGIN_REQUEST')\r\n\r\n/** Выход пользователя из системы (logout) */\r\nexport const userLogoutRequest: any = createAction('AUTH/USER_LOGOUT_REQUEST')\r\n\r\n/** Записать объект пользователя в стор */\r\nexport const userFetchSuccess: any = createAction('AUTH/USER_FETCH_SUCCESS')\r\n\r\n/** Ошибка получения объекта пользователя */\r\nexport const userFetchFailure: any = createAction('AUTH/USER_FETCH_FAILURE')\r\n","import { useShallowEqualSelector } from 'hooks/useShallowEqualSelector'\nimport { UserDTO } from 'services/auth'\n\nconst UserProfile = () => {\n  const { name, email, role } = useShallowEqualSelector(\n    (state) => state.auth.user\n  ) as UserDTO\n  return (\n    <>\n      <p>Имя: {name}</p>\n      <p>Email: {email}</p>\n      <p>Роль: {role}</p>\n    </>\n  )\n}\n\nexport { UserProfile }\n","import { FC, useState } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport { Menu, Dropdown, Avatar } from 'antd'\nimport {\n  UserOutlined,\n  LogoutOutlined,\n  ProfileOutlined\n} from '@ant-design/icons'\nimport { useActions } from 'hooks/useActions'\nimport { ModalWindow } from 'containers/ModalWindow'\nimport { userLogoutRequest } from 'modules/Auth/actions'\nimport { UserProfile } from '../UserProfile'\n\nconst UserMenu: FC = () => {\n  const [userProfileModalVisibility, setUserProfileModalVisibility] = useState(\n    false\n  )\n  const history = useHistory()\n  const [dispatchUserLogoutRequest] = useActions([userLogoutRequest], null)\n\n  const handleMenuClick = (event) => {\n    const { key } = event\n\n    switch (key) {\n      case 'profile':\n        setUserProfileModalVisibility(true)\n        break\n      case 'logout':\n        dispatchUserLogoutRequest()\n        history.push('/auth/login')\n        break\n      default:\n        break\n    }\n  }\n\n  const menu = (\n    <Menu onClick={handleMenuClick}>\n      <Menu.Item key=\"profile\" icon={<ProfileOutlined />}>\n        Профиль\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item key=\"logout\" icon={<LogoutOutlined />}>\n        Выход\n      </Menu.Item>\n    </Menu>\n  )\n\n  return (\n    <>\n      <Dropdown overlay={menu} trigger={['click']}>\n        <Avatar className=\"user-profile\" icon={<UserOutlined />} />\n      </Dropdown>\n      <ModalWindow\n        title=\"Профиль\"\n        visible={userProfileModalVisibility}\n        onCancel={() => setUserProfileModalVisibility(false)}\n      >\n        <UserProfile />\n      </ModalWindow>\n    </>\n  )\n}\n\nexport { UserMenu }\n","import { FC } from 'react'\nimport { Layout, Typography } from 'antd'\nimport { MenuUnfoldOutlined, MenuFoldOutlined } from '@ant-design/icons'\nimport { useShallowEqualSelector } from 'hooks/useShallowEqualSelector'\nimport { MainMenu } from 'components/MainMenu'\nimport { UserMenu } from 'components/UserMenu'\nimport { PrivateContainer } from 'containers/Private'\n\nconst { Text } = Typography\n\ninterface IHeaderProps {\n  sidebarCollapsed: boolean\n  onSidebarToggle: (isCollapsed: boolean) => void\n}\n\nconst { Header: AntHeader } = Layout\n\nconst Header: FC<IHeaderProps> = (props: IHeaderProps) => {\n  const activeChannel = useShallowEqualSelector(\n    (state) => state.chat.activeChannel\n  ) as any\n\n  const { onSidebarToggle, sidebarCollapsed } = props\n\n  const onTriggerClick = () => {\n    onSidebarToggle(!sidebarCollapsed)\n  }\n\n  const menuTrigger = sidebarCollapsed ? (\n    <MenuUnfoldOutlined\n      style={{ fontSize: '20px', padding: '22px' }}\n      className=\"trigger\"\n      onClick={onTriggerClick}\n      label=\"Свернуть\"\n    />\n  ) : (\n    <MenuFoldOutlined\n      style={{ fontSize: '20px', padding: '22px' }}\n      className=\"trigger\"\n      onClick={onTriggerClick}\n    />\n  )\n\n  const activeChannelLabel = activeChannel && (\n    <div className=\"active-channel\">\n      <Text className=\"active-channel-text\">{activeChannel.name}</Text>\n      {activeChannel.type === 'channel' ? (\n        <Text className=\"active-channel-text\" type=\"secondary\">\n          5 участников\n        </Text>\n      ) : (\n        <Text className=\"active-channel-text\" type=\"secondary\">\n          был(а) 1 час назад\n        </Text>\n      )}\n    </div>\n  )\n\n  return (\n    <AntHeader className=\"header background-white\">\n      <PrivateContainer>\n        {menuTrigger}\n        {activeChannelLabel}\n      </PrivateContainer>\n\n      <div className=\"header-menu\">\n        <MainMenu />\n        <PrivateContainer>\n          <UserMenu />\n        </PrivateContainer>\n      </div>\n    </AntHeader>\n  )\n}\n\nexport { Header }\n","import { FC, useState } from 'react'\nimport { Form, Input, message, Upload, Button, Spin } from 'antd'\nimport { LoadingOutlined } from '@ant-design/icons'\nimport ImgCrop from 'antd-img-crop'\nimport { UserDTO } from 'services/auth'\nimport { useActions } from 'hooks/useActions'\nimport { setActiveChannel, addChannel } from 'modules/Chat/actions'\nimport { channelService } from 'services/channel'\nimport { useShallowEqualSelector } from 'hooks/useShallowEqualSelector'\nimport { WS } from 'services/socket'\n\n// TODO move Upload image to separate component\n\ninterface FormValues {\n  name: string\n  description?: string\n  photo?: string\n}\n\ninterface ICreateChannelProps {\n  onCancel?: () => any\n  onOk?: () => any\n}\n\nconst beforeUpload = (file) => {\n  const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png'\n  if (!isJpgOrPng) {\n    message.error('Допустимые форматы файлов: JPG или PNG!')\n  }\n  const isLt2M = file.size / 1024 / 1024 < 2\n  if (!isLt2M) {\n    message.error('Размер изображения не должен превышать 2Мб!')\n  }\n  return isJpgOrPng && isLt2M\n}\n\nconst getBase64 = async (file): Promise<string> => {\n  let src = file.url\n  const resizeWidth = 300\n\n  if (!src) {\n    src = await new Promise((resolve) => {\n      const reader = new FileReader()\n      reader.readAsDataURL(file.originFileObj)\n      reader.onload = (event) => {\n        const img = new Image()\n        img.src = event.target.result as string\n        img.onload = (el: any) => {\n          const elem = document.createElement('canvas')\n          const scaleFactor = resizeWidth / el.target.width\n          elem.width = resizeWidth\n          elem.height = el.target.height * scaleFactor\n          const ctx = elem.getContext('2d')\n          ctx.drawImage(el.target, 0, 0, elem.width, elem.height)\n          const srcEncoded = ctx.canvas.toDataURL('image/jpeg', 0.3)\n          resolve(srcEncoded)\n        }\n      }\n    })\n  }\n  return src\n}\n\nconst onPreview = async (file) => {\n  const src = await getBase64(file)\n  const image = new Image()\n  image.src = src\n  const imgWindow = window.open(src)\n  imgWindow.document.write(image.outerHTML)\n}\n\nconst CreateChannel: FC<ICreateChannelProps> = (props) => {\n  const { onCancel, onOk } = props\n  const user = useShallowEqualSelector((state) => state.auth.user) as UserDTO\n  const [form] = Form.useForm()\n  const [loading, setLoading] = useState(false)\n  const [photo, setPhoto] = useState(null)\n  const [dispatchActiveChannel, dispatchAddChannel] = useActions(\n    [setActiveChannel, addChannel],\n    null\n  )\n\n  const onFinish = async (values: FormValues) => {\n    try {\n      const { name, description } = values\n      setLoading(true)\n\n      const {\n        type,\n        message: serverMessage,\n        data\n      } = await channelService.createChannel({\n        name,\n        description,\n        photo,\n        ownerId: user.id\n      })\n\n      if (serverMessage) {\n        if (type === 'success') {\n          message.success(serverMessage)\n        }\n        if (type === 'error') {\n          message.error(serverMessage)\n          setLoading(false)\n          return\n        }\n      }\n\n      const activeChannelPayload = { id: data.channelId, name, type: 'channel' }\n\n      dispatchAddChannel({\n        ...activeChannelPayload,\n        ownerId: user.id,\n        photo,\n        members: [user.id]\n      })\n      dispatchActiveChannel(activeChannelPayload)\n      WS.subscribeToChannel(data.channelId)\n\n      setLoading(false)\n      onOk()\n    } catch (error) {\n      setLoading(false)\n      message.error(error.message)\n    }\n  }\n\n  const [fileList, setFileList] = useState([])\n\n  const onChange = async ({ fileList: newFileList }) => {\n    const file = newFileList[0]\n    if (file?.status === 'done') {\n      const imageUrl = await getBase64(file)\n      setPhoto(imageUrl)\n    }\n\n    setFileList(newFileList)\n  }\n\n  const customRequest = (options) => {\n    const { onSuccess, file } = options\n    onSuccess(null, file)\n  }\n\n  const resetForm = () => {\n    setPhoto(null)\n    setFileList([])\n    form.resetFields()\n    onCancel()\n  }\n\n  return (\n    <>\n      <div className=\"upload-channel-photo\">\n        <ImgCrop\n          rotate\n          shape=\"round\"\n          modalTitle=\"Редактировать изображение\"\n          modalOk=\"Применить\"\n          modalCancel=\"Отмена\"\n        >\n          <Upload\n            listType=\"picture-card\"\n            fileList={fileList}\n            onChange={onChange}\n            beforeUpload={beforeUpload}\n            onPreview={onPreview}\n            customRequest={customRequest}\n          >\n            {!fileList.length && 'Выбрать фото'}\n          </Upload>\n        </ImgCrop>\n      </div>\n      <Form\n        form={form}\n        name=\"createChannel\"\n        className=\"create-channel-form\"\n        layout=\"vertical\"\n        onFinish={onFinish}\n      >\n        <Form.Item\n          name=\"name\"\n          rules={[\n            { required: true, message: 'Введите название канала' },\n            { max: 20, message: 'Не более 20 символов' }\n          ]}\n        >\n          <Input placeholder=\"Название канала\" />\n        </Form.Item>\n        <Form.Item\n          name=\"description\"\n          rules={[{ max: 50, message: 'Не более 50 символов' }]}\n        >\n          <Input placeholder=\"Описание (не обязательно)\" type=\"textarea\" />\n        </Form.Item>\n        <div className=\"form-footer\">\n          {loading && (\n            <Spin\n              className=\"center\"\n              indicator={<LoadingOutlined style={{ fontSize: 40 }} spin />}\n              delay={500}\n            />\n          )}\n          <Button key=\"back\" onClick={resetForm} disabled={loading}>\n            Отмена\n          </Button>\n          <Button\n            key=\"submit\"\n            type=\"primary\"\n            htmlType=\"submit\"\n            disabled={loading}\n          >\n            Создать\n          </Button>\n        </div>\n      </Form>\n    </>\n  )\n}\n\nexport { CreateChannel }\n","import { FC, useState } from 'react'\nimport { Menu, Dropdown } from 'antd'\nimport {\n  MenuOutlined,\n  UserAddOutlined,\n  UsergroupAddOutlined,\n  ContactsOutlined,\n  SettingOutlined\n} from '@ant-design/icons'\nimport { ModalWindow } from 'containers/ModalWindow'\nimport { CreateChannel } from '../CreateChannel'\n\nconst SidebarMenu: FC = () => {\n  const [\n    createChannelModalVisibility,\n    setCreateChannelModalVisibility\n  ] = useState(false)\n\n  const handleMenuClick = (event) => {\n    const { key } = event\n\n    switch (key) {\n      case 'createChannel':\n        setCreateChannelModalVisibility(true)\n        break\n      default:\n        break\n    }\n  }\n\n  const menu = (\n    <Menu onClick={handleMenuClick}>\n      <Menu.Item key=\"createChannel\" icon={<UsergroupAddOutlined />}>\n        Создать канал\n      </Menu.Item>\n      <Menu.Item key=\"addContact\" icon={<UserAddOutlined />}>\n        Добавить контакт\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item key=\"contacts\" icon={<ContactsOutlined />}>\n        Контакты\n      </Menu.Item>\n      <Menu.Item key=\"settings\" icon={<SettingOutlined />}>\n        Настройки\n      </Menu.Item>\n    </Menu>\n  )\n\n  return (\n    <>\n      <Dropdown overlay={menu} trigger={['click']}>\n        <MenuOutlined className=\"sidebar-icon\" />\n      </Dropdown>\n      <ModalWindow\n        title=\"Создать канал\"\n        visible={createChannelModalVisibility}\n        onCancel={() => setCreateChannelModalVisibility(false)}\n      >\n        <CreateChannel\n          onCancel={() => setCreateChannelModalVisibility(false)}\n          onOk={() => setCreateChannelModalVisibility(false)}\n        />\n      </ModalWindow>\n    </>\n  )\n}\n\nexport { SidebarMenu }\n","import { FC, useState } from 'react'\nimport { Layout, Menu, Avatar } from 'antd'\nimport { LockOutlined, UnlockOutlined, MessageFilled } from '@ant-design/icons'\nimport { Scrollbars } from 'react-custom-scrollbars'\nimport { useEscape } from 'hooks/useEscape'\nimport { useShallowEqualSelector } from 'hooks/useShallowEqualSelector'\nimport { setActiveChannel } from 'modules/Chat/actions'\nimport { useActions } from 'hooks/useActions'\nimport { IChannelData } from 'components/Chat/Messages'\nimport { SidebarMenu } from './SidebarMenu'\n\nconst { Sider } = Layout\n\ninterface ISidebarProps {\n  sidebarCollapsed: boolean\n  onSidebarToggle: (isCollapsed: boolean) => void\n}\n\nconst renderTrackVertical = ({ style, ...ownProps }) => (\n  <div\n    {...ownProps}\n    className=\"scrollTrackVertical\"\n    style={{\n      ...style,\n      backgroundColor: '#E5E5E5',\n      right: '2px',\n      bottom: '2px',\n      top: '2px',\n      borderRadius: '3px'\n    }}\n  />\n)\n\nconst renderThumbVertical = ({ style, ...ownProps }) => (\n  <div\n    {...ownProps}\n    className=\"scrollThumbVertical\"\n    style={{\n      ...style,\n      borderRadius: '4px',\n      boxShadow: '0 2px 4px 0 rgba(0, 0, 0, 0.16)',\n      backgroundColor: '#9A9A9A'\n    }}\n  />\n)\n\nconst Sidebar: FC<ISidebarProps> = (props: ISidebarProps) => {\n  const [sidebarLocked, setSidebarLocked] = useState(true)\n  const { sidebarCollapsed, onSidebarToggle } = props\n  const [dispatchActiveChannel] = useActions([setActiveChannel], null)\n  const chat = useShallowEqualSelector((state) => state.chat) as any\n  const { activeChannel, channels, contacts } = chat\n\n  useEscape(() => {\n    if (!activeChannel) return\n    dispatchActiveChannel(null)\n  })\n\n  const onClickMenu = ({ key }) => {\n    if (activeChannel) {\n      const { id, type } = activeChannel\n      if (key === `${type}-${id}`) return\n    }\n\n    const [channelType, channelId] = key.split('-')\n    const place = channelType === 'channel' ? channels : contacts\n    const { name, type } = place[channelId]\n\n    const intChannelId = parseInt(channelId, 10)\n    dispatchActiveChannel({ id: intChannelId, name, type })\n\n    if (!sidebarLocked) {\n      onSidebarToggle(true)\n    }\n  }\n\n  const selectedMenuKey = activeChannel\n    ? [`${activeChannel.type}-${activeChannel.id}`]\n    : []\n\n  return (\n    <>\n      <Sider\n        trigger={null}\n        collapsed={sidebarCollapsed}\n        collapsedWidth={0}\n        className=\"sider\"\n        theme=\"dark\"\n        style={{\n          overflow: 'auto',\n          height: '100vh'\n        }}\n      >\n        <div className=\"sidebar-top\">\n          <SidebarMenu />\n          {sidebarLocked ? (\n            <LockOutlined\n              title=\"Отмена фиксации\"\n              className=\"sidebar-icon\"\n              onClick={() => setSidebarLocked(false)}\n            />\n          ) : (\n            <UnlockOutlined\n              title=\"Фиксировать меню\"\n              className=\"sidebar-icon\"\n              onClick={() => setSidebarLocked(true)}\n            />\n          )}\n        </div>\n\n        <div className=\"channels-menu\">\n          <span className=\"channels-menu-title\">Каналы</span>\n          {(channels && Object.keys(channels).length && (\n            <Scrollbars\n              style={{ height: 'calc(50vh - 58px)' }}\n              hideTracksWhenNotNeeded\n              autoHide\n              autoHideTimeout={400}\n              renderTrackVertical={renderTrackVertical}\n              renderThumbVertical={renderThumbVertical}\n            >\n              <Menu\n                theme=\"dark\"\n                mode=\"inline\"\n                selectedKeys={selectedMenuKey}\n                onClick={onClickMenu}\n              >\n                {Object.entries(channels as IChannelData).map(\n                  ([channelId, channel]) => (\n                    <Menu.Item key={`${channel.type}-${channelId}`}>\n                      {channel.photo ? (\n                        <Avatar className=\"channel-photo\" src={channel.photo} />\n                      ) : (\n                        <Avatar\n                          className=\"channel-photo\"\n                          icon={<MessageFilled style={{ color: '#fefefe' }} />}\n                        />\n                      )}\n\n                      <span className=\"channel-name\">{channel.name}</span>\n                    </Menu.Item>\n                  )\n                )}\n              </Menu>\n            </Scrollbars>\n          )) || <p className=\"nocontent\">нет каналов</p>}\n        </div>\n\n        <div className=\"contacts-menu\">\n          <span className=\"contacts-menu-title\">Контакты</span>\n          {(contacts && Object.keys(contacts).length && (\n            <Scrollbars\n              style={{ height: 'calc(50vh - 58px)' }}\n              hideTracksWhenNotNeeded\n              autoHide\n              autoHideTimeout={400}\n              renderTrackVertical={renderTrackVertical}\n              renderThumbVertical={renderThumbVertical}\n            >\n              <Menu\n                theme=\"dark\"\n                mode=\"inline\"\n                selectedKeys={selectedMenuKey}\n                onClick={onClickMenu}\n              >\n                {Object.entries(contacts as IChannelData).map(\n                  ([channelId, channel]) => (\n                    <Menu.Item key={`${channel.type}-${channelId}`}>\n                      {channel.name}\n                    </Menu.Item>\n                  )\n                )}\n              </Menu>\n            </Scrollbars>\n          )) || <p className=\"nocontent\">нет контактов</p>}\n        </div>\n      </Sider>\n    </>\n  )\n}\n\nexport { Sidebar }\n","import { useEffect } from 'react'\n\nconst useEscape = (onEscape: () => any) => {\n  useEffect(() => {\n    const handleEsc = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') onEscape()\n    }\n    window.addEventListener('keydown', handleEsc)\n\n    return () => {\n      window.removeEventListener('keydown', handleEsc)\n    }\n  }, [onEscape])\n}\n\nexport { useEscape }\n","import { FC } from 'react'\r\nimport { Route, Redirect, RouteProps } from 'react-router-dom'\r\nimport { useShallowEqualSelector } from 'hooks/useShallowEqualSelector'\r\nimport { IRootState } from 'modules'\r\n\r\ninterface IPrivateRouteProps extends RouteProps {\r\n  component?: any\r\n  children?: any\r\n}\r\n\r\nconst PrivateRoute: FC<IPrivateRouteProps> = ({\r\n  component: Component,\r\n  children,\r\n  ...rest\r\n}) => {\r\n  const user = useShallowEqualSelector((state: IRootState) => state.auth.user)\r\n\r\n  return (\r\n    <Route\r\n      {...rest}\r\n      render={(routeProps) => {\r\n        if (user === null) return null\r\n\r\n        if (user === false) {\r\n          return (\r\n            <Redirect\r\n              to={{\r\n                pathname: '/auth/login',\r\n                state: { from: routeProps.location }\r\n              }}\r\n            />\r\n          )\r\n        }\r\n\r\n        if (Component) {\r\n          return <Component {...routeProps} />\r\n        }\r\n\r\n        return children\r\n      }}\r\n    />\r\n  )\r\n}\r\n\r\nPrivateRoute.defaultProps = {\r\n  component: undefined\r\n}\r\n\r\nexport { PrivateRoute }\r\n","import { FC } from 'react'\nimport { Empty } from 'antd'\n\ninterface IMessagesProps {\n  channel: IChannelData\n}\n\nexport interface IChannelData {\n  id: number | string\n  name: string\n  type: string // contact(user) | channel\n  messages: IMessage[]\n}\n\ninterface IMessage {\n  id: string\n  text: string\n  from: string | number // todo userId\n  type?: string\n}\n\nconst Messages: FC<IMessagesProps> = ({\n  channel: { messages }\n}: IMessagesProps) =>\n  (!messages?.length && (\n    <div className=\"chat-empty\">\n      <Empty description=\"Сообщений нет\" />\n    </div>\n  )) || (\n    <div className=\"chat-window\">\n      {messages.map(({ id, text, from }) => (\n        <div key={id}>\n          <strong>{from}</strong>: {text}\n        </div>\n      ))}\n    </div>\n  )\n\nexport { Messages }\n","import { FC, memo } from 'react'\nimport { Form, Input, Button } from 'antd'\nimport { SendOutlined } from '@ant-design/icons'\n\ninterface IFormValues {\n  text: string\n}\n\ninterface IChatInputProps {\n  sendMessage: (text: string) => void\n}\n\nconst InputMessage: FC<IChatInputProps> = memo(({ sendMessage }) => {\n  const [form] = Form.useForm()\n\n  const onFinish = async (values: IFormValues) => {\n    try {\n      const { text } = values\n      sendMessage(text)\n      form.resetFields()\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.log(error)\n    }\n  }\n  return (\n    <div className=\"chat-input\">\n      <Form size=\"large\" className=\"input-form\" form={form} onFinish={onFinish}>\n        <Form.Item className=\"input-messaage\" required name=\"text\">\n          <Input autoFocus placeholder=\"Введите сообщение\" />\n        </Form.Item>\n        <Form.Item className=\"send-button\">\n          <Button htmlType=\"submit\" type=\"primary\" icon={<SendOutlined />}>\n            Отправить\n          </Button>\n        </Form.Item>\n      </Form>\n    </div>\n  )\n})\n\nexport { InputMessage }\n","import { useCallback } from 'react'\nimport { nanoid } from 'nanoid'\nimport { UserDTO } from 'services/auth'\nimport { Empty } from 'antd'\nimport { useShallowEqualSelector } from 'hooks/useShallowEqualSelector'\nimport { sendChannelMessage, sendContactMessage } from 'modules/Chat/actions'\nimport { useActions } from 'hooks/useActions'\nimport { WS } from 'services/socket'\nimport { Messages } from './Messages'\nimport { InputMessage } from './InputMessage'\n\nconst Chat = () => {\n  const user = useShallowEqualSelector((state) => state.auth.user) as UserDTO\n  const [dispatchSendChannelMessage, dispatchSendContactMessage] = useActions(\n    [sendChannelMessage, sendContactMessage],\n    null\n  )\n  const { activeChannel, channels, contacts } = useShallowEqualSelector(\n    (state) => state.chat\n  ) as any\n\n  const onSendMessage = useCallback(\n    (text: string): void => {\n      if (!activeChannel) return\n      if (!text) return\n\n      const id = nanoid()\n      const { id: userId, name } = user\n      const message = { id, text, from: `${name}(${userId})` }\n      const payload = {\n        activeChannelId: activeChannel.id,\n        message\n      }\n\n      if (activeChannel.type === 'channel') {\n        dispatchSendChannelMessage(payload)\n        WS.sendChannelMessage(payload)\n      }\n\n      if (activeChannel.type === 'contact') {\n        dispatchSendContactMessage(payload)\n        WS.sendContactMessage({ from: user.id, to: activeChannel.id, message })\n      }\n    },\n    [\n      activeChannel,\n      dispatchSendChannelMessage,\n      dispatchSendContactMessage,\n      user\n    ]\n  )\n\n  if (!user || !activeChannel || (!channels && !contacts))\n    return (\n      <div className=\"chat-empty\">\n        <Empty description=\"Выберите канал для начала общения!\" />\n      </div>\n    )\n\n  const { type, id } = activeChannel\n  const channelData = type === 'channel' ? channels[id] : contacts[id]\n\n  if (!channelData) return null\n\n  return (\n    <>\n      <Messages channel={channelData} />\n      <InputMessage sendMessage={onSendMessage} />\n    </>\n  )\n}\n\nexport { Chat }\n","import {\n  apiService as api,\n  AUTH_TOKEN_STORAGE_KEY,\n  IServerResponse\n} from './api'\n\nexport interface UserLoginRequestDTO {\n  email: string\n  password: string\n}\n\nexport interface UserCreateRequestDTO {\n  name: string\n  email: string\n  password: string\n}\n\nexport interface UserDTO {\n  id: number\n  name: string\n  email: string\n  role: string\n}\n\nexport interface UserRecoverPasswordRequestDTO {\n  email: string\n}\n\nexport interface CheckSecretRequestDTO {\n  code: string\n  secretType: string\n}\n\nexport interface ChangePasswordRequestDTO {\n  code: string\n  password: string\n}\n\nexport interface UserFetchByTokenRequestDTO {\n  token: string\n}\n\nconst authService = {\n  /** Получить список всех пользователей */\n  getAllUsers: async (): Promise<IServerResponse> =>\n    api.send({\n      method: 'get',\n      endpoint: '/api/v1/auth/users'\n    }),\n  /** Регистрация нового пользователя */\n  register: async (payload: UserCreateRequestDTO): Promise<IServerResponse> =>\n    api.send({\n      method: 'put',\n      endpoint: '/api/v1/auth/register',\n      payload\n    }),\n\n  /** Активация пользователя по коду из письма */\n  activate: async (code: string): Promise<IServerResponse> =>\n    api.send({\n      method: 'patch',\n      endpoint: `/api/v1/auth/activate/${code}`\n    }),\n\n  /** Вход пользователя в систему и полуение токена */\n  login: async (payload: UserLoginRequestDTO): Promise<IServerResponse> =>\n    api.send({\n      method: 'post',\n      endpoint: '/api/v1/auth/login',\n      payload\n    }),\n\n  /** Попытка получить объект пользователя по токену */\n  fetchByToken: async (\n    payload: UserFetchByTokenRequestDTO\n  ): Promise<IServerResponse> =>\n    api.send({\n      method: 'post',\n      endpoint: '/api/v1/auth/fetch-by-token',\n      payload\n    }),\n\n  /** Запрос на изменение пароля, отправка письма со ссылкой на email */\n  recover: async (\n    payload: UserRecoverPasswordRequestDTO\n  ): Promise<IServerResponse> =>\n    api.send({\n      method: 'post',\n      endpoint: '/api/v1/auth/recover',\n      payload\n    }),\n\n  /** Проверка секретного ключа для доступа к форме восстановления пароля */\n  checkSecret: async (\n    payload: CheckSecretRequestDTO\n  ): Promise<IServerResponse> =>\n    api.send({\n      method: 'post',\n      endpoint: '/api/v1/auth/check-secret',\n      payload\n    }),\n\n  /** Изменение пароля пользователя */\n  changePassword: async (\n    payload: ChangePasswordRequestDTO\n  ): Promise<IServerResponse> =>\n    api.send({\n      method: 'patch',\n      endpoint: '/api/v1/auth/change-password',\n      payload\n    }),\n\n  getToken: (): string | null => localStorage.getItem(AUTH_TOKEN_STORAGE_KEY),\n\n  setToken: (payload: string): void =>\n    localStorage.setItem(AUTH_TOKEN_STORAGE_KEY, payload),\n\n  removeToken: (): void => localStorage.removeItem(AUTH_TOKEN_STORAGE_KEY)\n}\n\nexport { authService }\n","import { FC, useState } from 'react'\nimport { Form, Input, Button, Card, Alert, Spin } from 'antd'\nimport { MailOutlined, LockOutlined, LoadingOutlined } from '@ant-design/icons'\nimport { Link, useHistory } from 'react-router-dom'\nimport { useActions } from 'hooks/useActions'\nimport { authService } from 'services/auth'\nimport { userLoginRequest } from 'modules/Auth/actions'\n\ninterface IFormValues {\n  email: string\n  password: string\n}\n\nconst Login: FC = () => {\n  const emptyMessage = { type: '', message: '' }\n  const [form] = Form.useForm()\n  const [alert, setAlert] = useState(emptyMessage)\n  const [loading, setLoading] = useState(false)\n  const [dispatchUserLoginRequest] = useActions([userLoginRequest], null)\n  const history = useHistory()\n\n  const onFinish = async (values: IFormValues) => {\n    try {\n      setAlert(emptyMessage)\n      setLoading(true)\n\n      const { email, password } = values\n      const { type, message, token, data } = await authService.login({\n        email,\n        password\n      })\n\n      if (message) {\n        setAlert({ type, message })\n        setLoading(false)\n        if (type === 'error') return\n      }\n\n      dispatchUserLoginRequest({ data, token })\n      setLoading(false)\n\n      history.push('/')\n    } catch (error) {\n      setAlert(error)\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"flex-center\">\n      <Card className=\"card\" title=\"Вход в систему\">\n        {alert.message && (\n          <Alert\n            className=\"alert\"\n            message={alert.message}\n            type={alert.type as any}\n          />\n        )}\n        <Form\n          form={form}\n          name=\"login\"\n          className=\"login-form\"\n          initialValues={{ remember: true }}\n          onFinish={onFinish}\n        >\n          <Form.Item\n            name=\"email\"\n            rules={[\n              {\n                required: true,\n                type: 'email',\n                min: 4,\n                message: 'Некорректный email'\n              }\n            ]}\n          >\n            <Input prefix={<MailOutlined />} placeholder=\"Email\" size=\"large\" />\n          </Form.Item>\n\n          <Form.Item\n            name=\"password\"\n            rules={[{ required: true, min: 6, message: 'Минимум 6 символов' }]}\n          >\n            <Input.Password\n              placeholder=\"Пароль\"\n              prefix={<LockOutlined />}\n              size=\"large\"\n            />\n          </Form.Item>\n\n          <Form.Item>\n            <Form.Item name=\"register\" noStyle>\n              <Link to=\"/auth/register\">Регистрация</Link>\n            </Form.Item>\n\n            <Link className=\"link-recover\" to=\"/auth/recover\">\n              Забыли пароль?\n            </Link>\n          </Form.Item>\n\n          {loading && (\n            <Spin\n              className=\"center\"\n              indicator={<LoadingOutlined style={{ fontSize: 40 }} spin />}\n              delay={500}\n            />\n          )}\n\n          <Button size=\"large\" type=\"primary\" htmlType=\"submit\" block>\n            Войти\n          </Button>\n        </Form>\n      </Card>\n    </div>\n  )\n}\n\nexport { Login }\n","import { FC, useState } from 'react'\nimport { Form, Input, Button, Card, Alert, Spin } from 'antd'\nimport {\n  UserOutlined,\n  LockOutlined,\n  MailOutlined,\n  LoadingOutlined\n} from '@ant-design/icons'\nimport { authService } from 'services/auth'\n\ninterface IFormValues {\n  name: string\n  email: string\n  password: string\n}\n\nconst Register: FC = () => {\n  const emptyMessage = { type: '', message: '' }\n  const [form] = Form.useForm()\n  const [alert, setAlert] = useState(emptyMessage)\n  const [loading, setLoading] = useState(false)\n\n  const onFinish = async (values: IFormValues) => {\n    try {\n      setAlert(emptyMessage)\n      setLoading(true)\n\n      const { name, email, password } = values\n      const { type, message } = await authService.register({\n        name,\n        email,\n        password\n      })\n\n      if (message) {\n        setAlert({ type, message })\n        setLoading(false)\n        if (type === 'error') return\n      }\n\n      form.resetFields()\n      setLoading(false)\n    } catch (error) {\n      setAlert(error)\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"flex-center\">\n      <Card className=\"card\" title=\"Регистрация\">\n        {alert.message && (\n          <Alert\n            className=\"alert\"\n            message={alert.message}\n            type={alert.type as any}\n          />\n        )}\n        <Form\n          form={form}\n          name=\"register\"\n          initialValues={{ remember: true }}\n          onFinish={onFinish}\n          validateTrigger=\"onBlur\"\n        >\n          <Form.Item\n            name=\"name\"\n            rules={[\n              {\n                required: true,\n                message:\n                  \"Имя должно содержать минимум 4 символа английского или русского алфавита, допустимы цифры и знаки '- _'\",\n                pattern: /^[a-zA-Zа-яА-ЯёЁ0-9-_\\s]{4,}$/\n              }\n            ]}\n          >\n            <Input placeholder=\"Имя\" size=\"large\" prefix={<UserOutlined />} />\n          </Form.Item>\n\n          <Form.Item\n            name=\"email\"\n            rules={[\n              { required: true, type: 'email', message: 'Некорректный email' }\n            ]}\n          >\n            <Input prefix={<MailOutlined />} placeholder=\"Email\" size=\"large\" />\n          </Form.Item>\n\n          <Form.Item\n            name=\"password\"\n            rules={[\n              {\n                required: true,\n                message: 'Введите пароль! Минимум 6 символов.',\n                min: 6\n              }\n            ]}\n          >\n            <Input.Password\n              placeholder=\"Пароль\"\n              prefix={<LockOutlined />}\n              size=\"large\"\n            />\n          </Form.Item>\n\n          <Form.Item\n            name=\"confirm-password\"\n            dependencies={['password']}\n            rules={[\n              {\n                required: true,\n                message: 'Введите подтверждение пароля! Минимум 6 символов.',\n                min: 6\n              },\n              ({ getFieldValue }) => ({\n                validator(_, value) {\n                  if (!value || getFieldValue('password') === value) {\n                    return Promise.resolve()\n                  }\n                  return Promise.reject(new Error('Пароли должны совпадать!'))\n                }\n              })\n            ]}\n          >\n            <Input.Password\n              placeholder=\"Пароль еще раз\"\n              prefix={<LockOutlined />}\n              size=\"large\"\n            />\n          </Form.Item>\n\n          {loading && (\n            <Spin\n              className=\"center\"\n              indicator={<LoadingOutlined style={{ fontSize: 40 }} spin />}\n              delay={500}\n            />\n          )}\n\n          <Button\n            className=\"submit-button\"\n            type=\"primary\"\n            htmlType=\"submit\"\n            size=\"large\"\n            block\n            disabled={loading}\n          >\n            Зарегистрироваться\n          </Button>\n        </Form>\n      </Card>\n    </div>\n  )\n}\n\nexport { Register }\n","import { FC, useState } from 'react'\nimport { Form, Input, Button, Card, Alert, Spin } from 'antd'\nimport { MailOutlined, LoadingOutlined } from '@ant-design/icons'\nimport { authService } from 'services/auth'\n\ninterface IFormValues {\n  email: string\n}\n\nconst Recover: FC = () => {\n  const emptyMessage = { type: '', message: '' }\n  const [form] = Form.useForm()\n  const [alert, setAlert] = useState(emptyMessage)\n  const [loading, setLoading] = useState(false)\n\n  const onFinish = async (values: IFormValues) => {\n    try {\n      setAlert(emptyMessage)\n      setLoading(true)\n\n      const { email } = values\n      const { type, message } = await authService.recover({\n        email\n      })\n\n      if (message) {\n        setAlert({ type, message })\n        setLoading(false)\n        if (type === 'error') return\n      }\n\n      form.resetFields()\n      setLoading(false)\n    } catch (error) {\n      setAlert(error)\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"flex-center\">\n      <Card className=\"card\" title=\"Восстановление пароля\">\n        {alert.message && (\n          <Alert\n            className=\"alert\"\n            message={alert.message}\n            type={alert.type as any}\n          />\n        )}\n        {alert.type !== 'success' && (\n          <>\n            <p>\n              Укажите email, указанный при регистрации и мы вышлем на него\n              ссылку для восстановления пароля.\n            </p>\n            <Form\n              form={form}\n              name=\"recover\"\n              className=\"login-form\"\n              initialValues={{ remember: true }}\n              onFinish={onFinish}\n              validateTrigger=\"onBlur\"\n            >\n              <Form.Item\n                name=\"email\"\n                rules={[\n                  {\n                    required: true,\n                    type: 'email',\n                    message: 'Некорректный email!'\n                  }\n                ]}\n              >\n                <Input\n                  prefix={<MailOutlined />}\n                  placeholder=\"Email\"\n                  size=\"large\"\n                />\n              </Form.Item>\n\n              {loading && (\n                <Spin\n                  className=\"center\"\n                  indicator={<LoadingOutlined style={{ fontSize: 40 }} spin />}\n                  delay={500}\n                />\n              )}\n\n              <Button\n                size=\"large\"\n                type=\"primary\"\n                htmlType=\"submit\"\n                block\n                disabled={loading}\n              >\n                Восстановить пароль\n              </Button>\n            </Form>\n          </>\n        )}\n      </Card>\n    </div>\n  )\n}\n\nexport { Recover }\n","import { FC, useState, useEffect } from 'react'\nimport { useParams, Link } from 'react-router-dom'\nimport { Form, Input, Button, Card, Alert } from 'antd'\nimport { LockOutlined } from '@ant-design/icons'\nimport { authService } from 'services/auth'\n\ninterface IChangePasswordParams {\n  code?: string\n}\n\ninterface IFormValues {\n  password: string\n  confirmPassword: string\n}\n\nconst ChangePassword: FC = () => {\n  const { code }: IChangePasswordParams = useParams()\n  const emptyMessage = { type: '', message: '' }\n  const [alert, setAlert] = useState(emptyMessage)\n  const [secretError, setSecretError] = useState(false)\n  const [changeSuccess, setChangeSuccess] = useState(false)\n  const [loading, setLoading] = useState(false)\n\n  useEffect(() => {\n    const checkSecret = async () => {\n      const { type, message } = await authService.checkSecret({\n        code,\n        secretType: 'RECOVER_PASSWORD'\n      })\n      if (type === 'error') {\n        setAlert({ type, message })\n        setSecretError(true)\n      }\n    }\n\n    if (\n      code.match(\n        /^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i\n      )\n    ) {\n      checkSecret()\n    } else {\n      setAlert({ type: 'error', message: 'Неверный секретный код!' })\n      setSecretError(true)\n    }\n  }, [code])\n\n  const onFinish = async (values: IFormValues) => {\n    try {\n      setAlert(emptyMessage)\n      setLoading(true)\n\n      const { password } = values\n      const { type, message } = await authService.changePassword({\n        code,\n        password\n      })\n\n      if (message) {\n        setAlert({ type, message })\n        setLoading(false)\n        if (type === 'error') return\n      }\n\n      setChangeSuccess(true)\n      setLoading(false)\n    } catch (error) {\n      setAlert(error)\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"flex-center\">\n      <Card className=\"card\" title=\"Изменение пароля\">\n        {alert.message && (\n          <Alert\n            className=\"alert\"\n            message={alert.message}\n            type={alert.type as any}\n          />\n        )}\n\n        {changeSuccess && (\n          <p>\n            Теперь Вы можете <Link to=\"/auth/login\">Войти</Link> в приложение\n          </p>\n        )}\n\n        {!secretError && !changeSuccess && (\n          <>\n            <p>Придумайте новый пароль</p>\n            <Form\n              name=\"change-password-request\"\n              initialValues={{ remember: true }}\n              onFinish={onFinish}\n            >\n              <Form.Item\n                name=\"password\"\n                rules={[{ required: true, message: 'Введите пароль!' }]}\n              >\n                <Input.Password\n                  placeholder=\"Пароль\"\n                  prefix={<LockOutlined />}\n                  size=\"large\"\n                />\n              </Form.Item>\n\n              <Form.Item\n                name=\"confirmPassword\"\n                dependencies={['password']}\n                rules={[\n                  { required: true, message: 'Введите подтверждение пароля!' },\n                  ({ getFieldValue }) => ({\n                    validator(_, value) {\n                      if (!value || getFieldValue('password') === value) {\n                        return Promise.resolve()\n                      }\n                      return Promise.reject(\n                        new Error('Пароли должны совпадать!')\n                      )\n                    }\n                  })\n                ]}\n              >\n                <Input.Password\n                  placeholder=\"Пароль еще раз\"\n                  prefix={<LockOutlined />}\n                  size=\"large\"\n                />\n              </Form.Item>\n\n              <Button\n                className=\"submit-button\"\n                type=\"primary\"\n                htmlType=\"submit\"\n                size=\"large\"\n                block\n                disabled={loading}\n              >\n                Изменить пароль\n              </Button>\n            </Form>\n          </>\n        )}\n      </Card>\n    </div>\n  )\n}\n\nexport { ChangePassword }\n","import { FC, useState, useEffect } from 'react'\nimport { Card, Alert } from 'antd'\nimport { Link, useParams } from 'react-router-dom'\nimport { authService } from 'services/auth'\n\ninterface IActivationParams {\n  code?: string\n}\n\nconst Activation: FC = () => {\n  const { code }: IActivationParams = useParams()\n  const emptyMessage = { type: '', message: '' }\n  const [alert, setAlert] = useState(emptyMessage)\n\n  useEffect(() => {\n    const activateUser = async () => {\n      const { type, message } = await authService.activate(code)\n      if (message) {\n        setAlert({ type, message })\n      }\n    }\n    activateUser()\n  }, [code])\n\n  return (\n    <div className=\"flex-center\">\n      <Card className=\"card\" title=\"Активация нового пользователя\">\n        {alert.message && (\n          <Alert\n            className=\"alert\"\n            message={alert.message}\n            type={alert.type as any}\n          />\n        )}\n        <Link className=\"login-link\" to=\"/auth/login\">\n          Вход\n        </Link>\n        <Link className=\"link-recover\" to=\"/auth/recover\">\n          Восстановить пароль\n        </Link>\n      </Card>\n    </div>\n  )\n}\n\nexport { Activation }\n","import { FC } from 'react'\nimport { Switch, Route, Redirect } from 'react-router-dom'\n\nimport { PrivateRoute } from 'containers/PrivateRoute'\nimport { Chat } from '../Chat'\nimport { Login } from '../Login'\nimport { Register } from '../Register'\nimport { Recover } from '../Recover'\nimport { ChangePassword } from '../ChangePassword'\nimport { Activation } from '../Activation'\n\nconst Routes: FC = () => (\n  <Switch>\n    <PrivateRoute exact path=\"/\" component={Chat} />\n    <Route path=\"/auth/login\" component={Login} />\n    <Route path=\"/auth/register\" component={Register} />\n    <Route path=\"/auth/activation/:code\" component={Activation} />\n    <Route path=\"/auth/recover\" component={Recover} />\n    <Route path=\"/auth/change-password/:code\" component={ChangePassword} />\n    <Route path=\"*\">\n      <Redirect to=\"/auth/login\" />\n    </Route>\n  </Switch>\n)\n\nexport { Routes }\n","import { FC, useState, useEffect, useRef } from 'react'\nimport { UserDTO } from 'services/auth'\nimport { Layout } from 'antd'\nimport { PrivateContainer } from 'containers/Private'\nimport { sendChannelMessage, sendContactMessage } from 'modules/Chat/actions'\nimport { useShallowEqualSelector } from 'hooks/useShallowEqualSelector'\nimport { useActions } from 'hooks/useActions'\nimport { WS } from 'services/socket'\nimport { Header } from './Header'\nimport { Sidebar } from './Sidebar'\nimport { Routes } from '../Routes'\n\nconst { Content } = Layout\n\nconst App: FC = () => {\n  const [needRecreateRef, setNeedRecreateRef] = useState(0)\n  const [sidebarCollapsed, setSidebarCollapsed] = useState(false)\n  // const [onlineUsers, setOnlineUsers] = useState([])\n  const SR = useRef(null)\n  const [dispatchSendChannelMessage, dispatchSendContactMessage] = useActions(\n    [sendChannelMessage, sendContactMessage],\n    null\n  )\n  const activeChannel = useShallowEqualSelector(\n    (state) => state.chat.activeChannel\n  ) as any\n  const user = useShallowEqualSelector((state) => state.auth.user) as UserDTO\n\n  const onSidebarToggle = (isCollapsed: boolean) => {\n    setSidebarCollapsed(isCollapsed)\n  }\n\n  useEffect(() => {\n    if (!WS.socket) return null\n    SR.current = WS.socket\n\n    // Correct reconnection after server emits disconnected event\n    WS.socket.on('disconnect', (reason: string) => {\n      if (reason === 'transport error' || reason === 'ping timeout') {\n        if (!user) return\n        WS.disconnect()\n        WS.connect(user.id)\n        setNeedRecreateRef((state) => state + 1)\n      }\n    })\n\n    WS.socket.on('users:connected', () => {\n      // users.forEach((user) => {\n      // user.self = user.userId === WS.socket.id\n      // initReactiveProperties(user)\n      // dispatchUpdateUsersOnline(users)\n      // })\n      // put the current user first, and then sort by username\n      // setOnlineUsers(\n      //   users.sort((a, b) => {\n      //     if (a.self) return -1\n      //     if (b.self) return 1\n      //     if (a.username < b.username) return -1\n      //     return a.username > b.username ? 1 : 0\n      //   })\n      // )\n      // dispatchUpdateUsersOnline(users)\n      // eslint-disable-next-line no-console\n      // console.log(onlineUsers)\n    })\n\n    SR.current.on(\n      'channel:message:broadcast',\n      ({ activeChannelId: channelId, message }) => {\n        dispatchSendChannelMessage({\n          activeChannelId: channelId,\n          message\n        })\n      }\n    )\n\n    SR.current.on('contact:message:private', ({ message, from }) => {\n      // eslint-disable-next-line no-console\n      console.log('contact:message:private', message, `from: ${from}`)\n\n      dispatchSendContactMessage({\n        activeChannelId: from,\n        message\n      })\n    })\n\n    return () => {\n      SR.current.off('channel:message:broadcast')\n      SR.current.off('contact:message:private')\n    }\n  }, [\n    user,\n    activeChannel,\n    dispatchSendChannelMessage,\n    dispatchSendContactMessage,\n    needRecreateRef\n  ])\n\n  return (\n    <Layout className=\"wrap-layout\">\n      <PrivateContainer>\n        <Sidebar\n          sidebarCollapsed={sidebarCollapsed}\n          onSidebarToggle={onSidebarToggle}\n        />\n      </PrivateContainer>\n\n      <Layout className=\"site-layout\">\n        <Header\n          sidebarCollapsed={sidebarCollapsed}\n          onSidebarToggle={onSidebarToggle}\n        />\n        <Content className=\"content\">\n          <Routes />\n        </Content>\n      </Layout>\n    </Layout>\n  )\n}\n\nexport { App }\n","import { takeLatest, put, call, fork } from 'redux-saga/effects'\r\nimport { authService } from 'services/auth'\r\nimport { WS } from 'services/socket'\r\nimport {\r\n  userLoginRequest,\r\n  userLogoutRequest,\r\n  userFetchSuccess\r\n} from './actions'\r\nimport {\r\n  initChannelsData,\r\n  initContactsData,\r\n  setActiveChannel\r\n} from '../Chat/actions'\r\n\r\n/** login */\r\nexport function* userLoginRequestFlow({ payload: { data, token } }) {\r\n  yield put(userFetchSuccess(data))\r\n  yield call([authService, authService.setToken], token)\r\n  const { channels, contacts } = yield call([WS, WS.connect], data.id)\r\n  yield put(initChannelsData(channels))\r\n  yield put(initContactsData(contacts))\r\n}\r\nexport function* userLoginWatcher() {\r\n  yield takeLatest(userLoginRequest, userLoginRequestFlow)\r\n}\r\n\r\n/** logout */\r\nexport function* userLogoutRequestFlow() {\r\n  yield call([authService, authService.removeToken])\r\n  yield put(userFetchSuccess(false))\r\n  yield put(setActiveChannel(null))\r\n  yield call([WS, WS.disconnect])\r\n}\r\nexport function* userLogoutWatcher() {\r\n  yield takeLatest(userLogoutRequest, userLogoutRequestFlow)\r\n}\r\n\r\nconst authSagas = function* generator() {\r\n  yield fork(userLoginWatcher)\r\n  yield fork(userLogoutWatcher)\r\n}\r\n\r\nexport { authSagas }\r\n","import { combineReducers } from 'redux'\r\nimport { handleActions } from 'redux-actions'\r\nimport { UserDTO } from 'services/auth'\r\nimport { userFetchSuccess, userFetchFailure } from './actions'\r\n\r\nexport interface IAuthState {\r\n  user: UserDTO\r\n}\r\n\r\nexport const initialState = {\r\n  user: null\r\n}\r\n\r\nconst user = handleActions(\r\n  {\r\n    [userFetchSuccess]: (_state, action) => action.payload,\r\n    [userFetchFailure]: () => false\r\n  },\r\n  null\r\n)\r\n\r\nconst authReducer = combineReducers<IAuthState>({\r\n  user\r\n})\r\n\r\nexport { authReducer }\r\n","import { combineReducers } from 'redux'\r\nimport { handleActions } from 'redux-actions'\r\nimport {\r\n  setActiveChannel,\r\n  initChannelsData,\r\n  initContactsData,\r\n  sendChannelMessage,\r\n  sendContactMessage,\r\n  addChannel\r\n} from './actions'\r\n\r\nexport interface IActiveChannel {\r\n  id: number | null\r\n  name: string\r\n  type: string\r\n}\r\n\r\nexport interface IChatState {\r\n  activeChannel: IActiveChannel\r\n  channels: Object\r\n  contacts: Object\r\n}\r\n\r\nexport const initialState: IChatState = {\r\n  activeChannel: null,\r\n  channels: null,\r\n  contacts: null\r\n}\r\n\r\nconst activeChannel = handleActions(\r\n  {\r\n    [setActiveChannel]: (_state, action) => action.payload\r\n  },\r\n  null\r\n)\r\n\r\nconst addMessage = (state, action) => ({\r\n  ...state,\r\n  [action.payload.activeChannelId]: {\r\n    ...state[action.payload.activeChannelId],\r\n    messages: [\r\n      ...state[action.payload.activeChannelId].messages,\r\n      action.payload.message\r\n    ]\r\n  }\r\n})\r\n\r\nconst channels = handleActions(\r\n  {\r\n    [initChannelsData]: (_state, action) => action.payload,\r\n    [sendChannelMessage]: addMessage,\r\n    [addChannel]: (state, action) => ({\r\n      ...state,\r\n      [action.payload.id]: {\r\n        ownerId: action.payload.ownerId,\r\n        name: action.payload.name,\r\n        members: action.payload.members,\r\n        photo: action.payload.photo,\r\n        type: action.payload.type,\r\n        messages: []\r\n      }\r\n    })\r\n  },\r\n  null\r\n)\r\n\r\nconst contacts = handleActions(\r\n  {\r\n    [initContactsData]: (_state, action) => action.payload,\r\n    [sendContactMessage]: addMessage\r\n  },\r\n  null\r\n)\r\n\r\nconst chatReducer = combineReducers<IChatState>({\r\n  activeChannel,\r\n  channels,\r\n  contacts\r\n})\r\n\r\nexport { chatReducer }\r\n","import { call, put } from 'redux-saga/effects'\nimport { authService } from 'services/auth'\nimport { WS } from 'services/socket'\nimport { userFetchSuccess, userFetchFailure } from './Auth/actions'\nimport { initChannelsData, initContactsData } from './Chat/actions'\n\n/** Launch saga once when on app start */\nconst launchSaga = function* launchSaga() {\n  try {\n    const token = yield call([authService, authService.getToken])\n\n    if (!token) {\n      yield put(userFetchFailure())\n      return\n    }\n    const { data } = yield call([authService, authService.fetchByToken], {\n      token\n    })\n\n    if (!data) {\n      yield call([authService, authService.removeToken])\n      yield put(userFetchFailure())\n      return\n    }\n\n    yield put(userFetchSuccess(data))\n    const { channels, contacts } = yield call([WS, WS.connect], data.id)\n    yield put(initChannelsData(channels))\n    yield put(initContactsData(contacts))\n  } catch (error) {\n    yield call([authService, authService.removeToken])\n    yield put(userFetchFailure(error))\n  }\n}\n\nexport { launchSaga }\n","import { combineReducers } from 'redux'\nimport { fork } from 'redux-saga/effects'\nimport { authSagas } from './Auth/sagas'\nimport { authReducer, IAuthState } from './Auth/reducer'\nimport { chatReducer, IChatState } from './Chat/reducer'\nimport { launchSaga } from './launchSaga'\n\n// Root state interface\nexport interface IRootState {\n  auth: IAuthState\n  chat: IChatState\n}\n\nexport const initialState: IRootState = {\n  auth: { user: null },\n  chat: {\n    activeChannel: null,\n    channels: null,\n    contacts: null\n  }\n}\n\n// Root reducer\nexport const rootReducer = combineReducers({\n  auth: authReducer,\n  chat: chatReducer\n})\n\n// Root saga\nexport function* rootSaga() {\n  yield fork(authSagas)\n  yield fork(launchSaga)\n}\n","import { createStore, compose, applyMiddleware } from 'redux'\nimport { composeWithDevTools } from 'redux-devtools-extension'\nimport createSagaMiddleware from 'redux-saga'\nimport { rootReducer, rootSaga } from 'modules'\n\nconst createAppStore = () => {\n  const sagaMiddleware = createSagaMiddleware()\n  const store = createStore(\n    rootReducer,\n    compose(composeWithDevTools(applyMiddleware(sagaMiddleware)))\n  )\n\n  sagaMiddleware.run(rootSaga)\n  return store\n}\n\nexport { createAppStore }\n","import { ReportHandler } from 'web-vitals'\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\n// eslint-disable-next-line import/no-default-export\nexport default reportWebVitals\n","import { StrictMode } from 'react'\nimport { Provider } from 'react-redux'\nimport { BrowserRouter } from 'react-router-dom'\nimport { render } from 'react-dom'\nimport { App } from 'components/App'\nimport { createAppStore } from 'modules/store'\nimport reportWebVitals from 'reportWebVitals'\nimport 'index.scss'\n\nconst store = createAppStore()\n\nrender(\n  <StrictMode>\n    <Provider store={store}>\n      <BrowserRouter>\n        <App />\n      </BrowserRouter>\n    </Provider>\n  </StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}